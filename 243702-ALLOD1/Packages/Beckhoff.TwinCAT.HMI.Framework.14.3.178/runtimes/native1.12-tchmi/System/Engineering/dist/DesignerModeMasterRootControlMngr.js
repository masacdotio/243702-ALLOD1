var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{designerModeComManager}from"./DesignerModeComManager.js";import{metaDataManager}from"./DesignerModeControlMetaDataMngr.js";import{highlightManager}from"./DesignerModeMasterControlHighlightMngr.js";import{interactionManager}from"./DesignerModeMasterInteractionMngr.js";import{SyncCmdToCreatorRequestRequiredViewPortSize}from"./SyncCmdToCreatorRequestRequiredViewPortSize.js";TCHMI_DESIGNER||TcHmi.Log.errorEx(`Internal error: The file "${import.meta.url}" is restricted to use within the designer.`);let DesignerModeMasterRootControlManager=(()=>{var _a;let ___onRequiredViewPortSizeWatchTick_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onRequiredViewPortSizeWatchTick_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],__esDecorate(this,null,___onRequiredViewPortSizeWatchTick_decorators,{kind:"method",name:"__onRequiredViewPortSizeWatchTick",static:!1,private:!1,access:{has:obj=>"__onRequiredViewPortSizeWatchTick"in obj,get:obj=>obj.__onRequiredViewPortSizeWatchTick},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}constructor(){document.body.classList.add("tchmi-creator-chessboard"),this.__viewPortSimulator.classList.add("tchmi-creator-view-port-simulator"),this.__viewPortHighlightingContainer.classList.add("tchmi-creator-view-port-highlighting"),this.__backgroundTarget.classList.add("tchmi-creator-view-port-background"),window.setInterval(this.__onRequiredViewPortSizeWatchTick,50)}__viewPortSimulator=(__runInitializers(this,_instanceExtraInitializers),document.createElement("div"));__viewPortHighlightingContainer=document.createElement("div");__backgroundTarget=document.createElement("div");__rootControlMeta;__scrollPosition={left:0,top:0};__creatorZoomFactor=1;__viewportCurrentWidth=0;__viewportCurrentHeight=0;__scrollAnimationFrameId=0;__zoomAnimationFrameId=0;getCreatorZoomFactor(){return this.__creatorZoomFactor}getViewPortSimulator(){return this.__viewPortSimulator}getViewPortHighlightingContainer(){return this.__viewPortHighlightingContainer}getBackgroundTarget(){return this.__backgroundTarget}scroll(p){p.left===this.__scrollPosition.left&&p.top===this.__scrollPosition.top||(this.__scrollPosition.left=p.left,this.__scrollPosition.top=p.top,0!==this.__scrollAnimationFrameId&&window.cancelAnimationFrame(this.__scrollAnimationFrameId),this.__scrollAnimationFrameId=window.requestAnimationFrame((()=>{document.scrollingElement.scrollLeft=this.__scrollPosition.left,document.scrollingElement.scrollTop=this.__scrollPosition.top,this.__scrollAnimationFrameId=0})))}setCreatorZoom(newZoom){void 0!==newZoom&&this.__creatorZoomFactor!==newZoom&&(this.__creatorZoomFactor=newZoom,0!==this.__zoomAnimationFrameId&&window.cancelAnimationFrame(this.__zoomAnimationFrameId),this.__zoomAnimationFrameId=window.requestAnimationFrame((()=>{1!==this.__creatorZoomFactor?this.__viewPortSimulator.style.transform="scale("+this.__creatorZoomFactor+")":this.__viewPortSimulator.style.transform="",highlightManager?.updateEngineeringStyles(),interactionManager?.refreshControlSnapPositionCache(),metaDataManager.refreshControlMetaData(),this.__zoomAnimationFrameId=0})))}setRootControl(tco,newControlMeta){this.setCreatorViewPortPosition(tco),this.__rootControlMeta=newControlMeta,this.__viewPortSimulator.setAttribute("data-tchmi-creator-target-control-type",tco.getType())}__onRequiredViewPortSizeWatchTick(){if(!this.__rootControlMeta)return;let vpWidth=50,vpHeight=50;for(const elem of[this.__viewPortSimulator,this.__rootControlMeta.jHierarchyAnchorContainer[0],this.__rootControlMeta.jAnchorContainer[0]]){const sWidth=elem.scrollWidth,sHeight=elem.scrollHeight;sWidth>vpWidth&&(vpWidth=sWidth),sHeight>vpHeight&&(vpHeight=sHeight)}vpWidth+=30,vpHeight+=30,vpWidth===this.__viewportCurrentWidth&&vpHeight===this.__viewportCurrentHeight||(designerModeComManager.supportedCommandFromVS.includes("RequestRequiredViewPortSize")&&new SyncCmdToCreatorRequestRequiredViewPortSize({name:"RequestRequiredViewPortSize",frameworkType:TCHMI_DESIGNER?"Designer":"LiveView",targetPartial:TCHMI_TARGET_PARTIAL,width:vpWidth,height:vpHeight,replyTo:null}).send(),this.__viewportCurrentWidth=vpWidth,this.__viewportCurrentHeight=vpHeight,document.body.style.width=vpWidth+"px",document.body.style.height=vpHeight+"px")}setCreatorViewPortPosition(tco){if(!tco)return;let viewportWidth,attributeViewportWidth=0,attrStr=tco.getElement()[0].getAttribute("data-tchmi-creator-viewport-width");attrStr&&(attributeViewportWidth=TcHmi.ValueConverter.toType(attrStr,"tchmi:framework#/definitions/PositiveNumber")),viewportWidth="number"==typeof attributeViewportWidth&&attributeViewportWidth>0?attributeViewportWidth:TcHmi.System.config.creatorSettings.viewport.defaultWidth;let viewportWidthActive=!1,widthValue=tco.getWidth();const widthUnit=tco.getWidthUnit(),widthMode=tco.getWidthMode();if("Parent"===widthMode?widthValue=null:"Content"===widthMode&&(widthValue=tco.__getContentWidth()),("%"===widthUnit||null==widthValue)&&(viewportWidthActive=!0),!viewportWidthActive&&widthValue){let widthMinValue=tco.getMinWidth(),widthMinUnit=tco.getMinWidthUnit(),widthMinPix=widthMinValue;null!=widthMinValue&&"%"===widthMinUnit&&(widthMinPix=widthMinValue*viewportWidth/100),null!=widthMinPix&&widthValue<widthMinPix&&(viewportWidthActive=!0)}if(!viewportWidthActive&&widthValue){let widthMaxValue=tco.getMaxWidth(),widthMaxUnit=tco.getMaxWidthUnit(),widthMaxPix=widthMaxValue;null!=widthMaxValue&&"%"===widthMaxUnit&&(widthMaxPix=widthMaxValue*viewportWidth/100),null!=widthMaxPix&&widthValue>widthMaxPix&&(viewportWidthActive=!0)}let viewportHeight,viewportWidthFinal=viewportWidth;!viewportWidthActive&&widthValue&&(viewportWidthFinal=parseInt(tco.getElement().css("left"),10)+widthValue);let attributeViewportHeight=0;attrStr=tco.getElement()[0].getAttribute("data-tchmi-creator-viewport-height"),attrStr&&(attributeViewportHeight=TcHmi.ValueConverter.toType(attrStr,"tchmi:framework#/definitions/PositiveNumber")),viewportHeight="number"==typeof attributeViewportHeight&&attributeViewportHeight>0?attributeViewportHeight:TcHmi.System.config.creatorSettings.viewport.defaultHeight;let viewportHeightActive=!1,heightValue=tco.getHeight();const heightUnit=tco.getHeightUnit(),heightMode=tco.getHeightMode();if("Parent"===heightMode?heightValue=null:"Content"===heightMode&&(heightValue=tco.__getContentHeight()),("%"===heightUnit||null===heightValue)&&(viewportHeightActive=!0),!viewportHeightActive&&heightValue){let heightMinValue=tco.getMinHeight(),heightMinUnit=tco.getMinHeightUnit(),heightMinPix=heightMinValue;null!=heightMinValue&&"%"===heightMinUnit&&(heightMinPix=heightMinValue*viewportHeight/100),null!=heightMinPix&&heightValue<heightMinPix&&(viewportHeightActive=!0)}if(!viewportHeightActive&&heightValue){let heightMaxValue=tco.getMaxHeight(),heightMaxUnit=tco.getMaxHeightUnit(),heightMaxPix=heightMaxValue;null!=heightMaxValue&&"%"===heightMaxUnit&&(heightMaxPix=heightMaxValue*viewportHeight/100),null!=heightMaxPix&&heightValue>heightMaxPix&&(viewportHeightActive=!0)}let viewportHeightFinal=viewportHeight;!viewportHeightActive&&heightValue&&(viewportHeightFinal=parseInt(tco.getElement().css("top"),10)+heightValue),this.__viewPortSimulator.style.width=viewportWidthFinal+"px",this.__viewPortSimulator.style.height=viewportHeightFinal+"px",this.__viewPortHighlightingContainer.style.width=viewportWidthFinal*this.__creatorZoomFactor+"px",this.__viewPortHighlightingContainer.style.height=viewportHeightFinal*this.__creatorZoomFactor+"px"}}})();export{DesignerModeMasterRootControlManager};export const rootControlManager=new DesignerModeMasterRootControlManager;