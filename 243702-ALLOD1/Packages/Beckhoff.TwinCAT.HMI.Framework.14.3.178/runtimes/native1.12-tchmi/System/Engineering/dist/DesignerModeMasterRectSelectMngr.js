var __runInitializers=this&&this.__runInitializers||function(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__esDecorate=this&&this.__esDecorate||function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0};import{metaDataManager}from"./DesignerModeControlMetaDataMngr.js";import{designerModeManager}from"./DesignerModeManager.js";import{controlMoveManager}from"./DesignerModeMasterControlMoveMngr.js";import{controlResizeManager}from"./DesignerModeMasterControlResizeMngr.js";import{interactionManager}from"./DesignerModeMasterInteractionMngr.js";TCHMI_DESIGNER||TcHmi.Log.errorEx(`Internal error: The file "${import.meta.url}" is restricted to use within the designer.`);let DesignerModeMasterRectSelectManager=(()=>{var _a,_b,_c;let ___onDocumentRectSelectMouseDown_decorators,___onDocumentRectSelectMouseMove_decorators,___onDocumentRectSelectMouseUp_decorators,_instanceExtraInitializers=[];return class{static{const _metadata="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;___onDocumentRectSelectMouseDown_decorators=[(_a=TcHmi).CallbackMethod.bind(_a)],___onDocumentRectSelectMouseMove_decorators=[(_b=TcHmi).CallbackMethod.bind(_b)],___onDocumentRectSelectMouseUp_decorators=[(_c=TcHmi).CallbackMethod.bind(_c)],__esDecorate(this,null,___onDocumentRectSelectMouseDown_decorators,{kind:"method",name:"__onDocumentRectSelectMouseDown",static:!1,private:!1,access:{has:obj=>"__onDocumentRectSelectMouseDown"in obj,get:obj=>obj.__onDocumentRectSelectMouseDown},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDocumentRectSelectMouseMove_decorators,{kind:"method",name:"__onDocumentRectSelectMouseMove",static:!1,private:!1,access:{has:obj=>"__onDocumentRectSelectMouseMove"in obj,get:obj=>obj.__onDocumentRectSelectMouseMove},metadata:_metadata},null,_instanceExtraInitializers),__esDecorate(this,null,___onDocumentRectSelectMouseUp_decorators,{kind:"method",name:"__onDocumentRectSelectMouseUp",static:!1,private:!1,access:{has:obj=>"__onDocumentRectSelectMouseUp"in obj,get:obj=>obj.__onDocumentRectSelectMouseUp},metadata:_metadata},null,_instanceExtraInitializers),_metadata&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_metadata})}constructor(){this.__selectionDragHighlighter=document.createElement("div"),this.__selectionDragHighlighter.classList.add("tchmi-creator-selection-drag-container"),TcHmi.System.SharedResources.jqDocument.on(this.__documentRectSelectMouseDownNs,this.__onDocumentRectSelectMouseDown)}__selectionDragHighlighter=__runInitializers(this,_instanceExtraInitializers);__rectSelecting=!1;__lockRectSelect=!1;__documentRectSelectMouseMoveNs="mousemove.DesignerModeManager.DocumentRectSelectMouseMove";__documentRectSelectMouseUpNs="mouseup.DesignerModeManager.DocumentRectSelectMouseUp";__documentRectSelectMouseDownNs="mousedown.DesignerModeManager.DocumentRectSelectMouseDown";getRectSelecting(){return this.__rectSelecting}lockRectSelect(){this.__lockRectSelect=!0}resetState(){this.__selectionDragHighlighter.isConnected&&this.__selectionDragHighlighter.remove(),this.__rectSelecting=!1,this.__lockRectSelect=!1,TcHmi.System.SharedResources.jqDocument.off(this.__documentRectSelectMouseMoveNs),TcHmi.System.SharedResources.jqDocument.off(this.__documentRectSelectMouseUpNs)}__onDocumentRectSelectMouseDown(event){1===event.which&&event.originalEvent?.target!==document.documentElement&&(interactionManager?.handleInteractionStart(event,null),this.__lockRectSelect=!1,TcHmi.System.SharedResources.jqDocument.on(this.__documentRectSelectMouseMoveNs,this.__onDocumentRectSelectMouseMove),TcHmi.System.SharedResources.jqDocument.on(this.__documentRectSelectMouseUpNs,this.__onDocumentRectSelectMouseUp))}__onDocumentRectSelectMouseMove(event){if(void 0===event.pageX||void 0===event.pageY)return;if(1!==event.which)return;if(controlMoveManager.getControlMoveActive())return;if(controlResizeManager.getControlResizing())return;if(this.__lockRectSelect)return;const startMousePosition=interactionManager.getStartMousePos();let deltaStartLeft=event.pageX-startMousePosition.left,deltaStartTop=event.pageY-startMousePosition.top;if(Math.abs(deltaStartLeft)<=5&&Math.abs(deltaStartTop)<=5)return;let w=0,l=0,h=0,t=0;controlMoveManager.setMouseMoving(!0),deltaStartLeft>=0?(w=deltaStartLeft,l=startMousePosition.left):(w=-deltaStartLeft,l=startMousePosition.left+deltaStartLeft),deltaStartTop>=0?(h=deltaStartTop,t=startMousePosition.top):(h=-deltaStartTop,t=startMousePosition.top+deltaStartTop),TcHmi.StyleProvider.setSimpleElementStyle(this.__selectionDragHighlighter,{width:w+"px",left:l+"px",height:h+"px",top:t+"px","pointer-events":"none"}),this.__selectionDragHighlighter.parentElement||document.body.appendChild(this.__selectionDragHighlighter),this.__rectSelecting=!0,controlMoveManager.lockControlMove(),controlResizeManager.lockControlResize()}__onDocumentRectSelectMouseUp(event){if(void 0===event.pageX||void 0===event.pageY)return;let resetExistingSelections=!1;1!==event.which?controlMoveManager.setMouseMoving(!1):this.__lockRectSelect&&!this.__rectSelecting||(resetExistingSelections=!this.__processRectSelect(this.__selectionDragHighlighter.getBoundingClientRect(),event.ctrlKey??!1,event.altKey??!1),this.__selectionDragHighlighter.remove(),controlMoveManager.setMouseMoving(!1)),resetExistingSelections&&designerModeManager.unselectEach(!1),this.resetState()}__processRectSelect(rectDragSelection,ctrlKeyPressed,altKeyPressed){let res=!1,selectionHasChanged=!1,isFirstSelect=!0;const controlsToSelect=[],controlsMetaData=metaDataManager.getControlMetaData();for(const ctrlMeta of Object.values(controlsMetaData)){if(!ctrlMeta.domVisibility||ctrlMeta.controlCollapsed)continue;let bParentalOverride=!1,ctrlParentMeta=ctrlMeta.parent;for(;null!==ctrlParentMeta;){if(!ctrlParentMeta.domVisibility||ctrlParentMeta.controlCollapsed){bParentalOverride=!0;break}ctrlParentMeta=ctrlParentMeta.parent}if(bParentalOverride)continue;const tco=TcHmi.Controls.get(ctrlMeta.id);if(!tco)continue;if(!tco.getElement())continue;const controlRect=ctrlMeta.jControlPosition[0].getBoundingClientRect();if(this.__hasClientRectIntersection(controlRect,rectDragSelection,altKeyPressed)){if(ctrlMeta.isPartialRoot)continue;if(res=!0,isFirstSelect&&!ctrlKeyPressed){isFirstSelect=!1,designerModeManager.unselectEach(!0)&&(selectionHasChanged=!0)}let activeControl=controlMoveManager.getActiveControl();if(activeControl&&activeControl.id===ctrlMeta.id&&activeControl.isContainerControl&&ctrlKeyPressed)continue;let skip=!1,temp=activeControl;for(;temp;){if(temp.id===ctrlMeta.id){skip=!0;break}temp=temp.parent}if(skip)continue;controlsToSelect.push(ctrlMeta.id),selectionHasChanged=!0}}return controlsToSelect.forEach((ctrlName=>{designerModeManager.select(ctrlName,!0)})),selectionHasChanged&&designerModeManager.resyncSelectedControls(),res}__hasClientRectIntersection(rc1,rc2,rc1enclosedMode){let rc1l=rc1.left,rc1r=rc1.right,rc1t=rc1.top,rc1b=rc1.bottom,rc2l=rc2.left,rc2r=rc2.right,rc2t=rc2.top,rc2b=rc2.bottom;return rc1enclosedMode?rc1l>rc2l&&rc1r<rc2r&&rc1t>rc2t&&rc1b<rc2b:!(rc1l>rc2r||rc1r<rc2l||rc1t>rc2b||rc1b<rc2t)}}})();export{DesignerModeMasterRectSelectManager};export const rectSelectManager=new DesignerModeMasterRectSelectManager;